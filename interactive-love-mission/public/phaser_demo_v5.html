<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Love Run - Premium Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Fredoka', sans-serif;
            touch-action: none;
        }

        /* UI G√ºzelle≈ütirme */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 4px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 40px rgba(255, 105, 180, 0.3);
        }

        /* Y√ºkleme Alanƒ± */
        .upload-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px dashed #FF69B4;
            background: #FFF0F5;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .upload-circle:hover {
            transform: scale(1.05);
            border-color: #FF1493;
        }

        .upload-circle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Mobil Tu≈ülar */
        #controls {
            display: none;
            position: absolute;
            bottom: 20px;
            width: 100%;
            padding: 0 20px;
            box-sizing: border-box;
            justify-content: space-between;
            z-index: 40;
            pointer-events: none;
        }

        .game-btn {
            width: 75px;
            height: 75px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
            backdrop-filter: blur(4px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            pointer-events: auto;
            transition: transform 0.1s;
        }

        .game-btn:active {
            transform: scale(0.9);
            background: rgba(255, 255, 255, 0.4);
        }
    </style>
</head>

<body>

    <div id="ui-layer">
        <div class="glass-panel p-8 rounded-3xl text-center max-w-md w-full mx-4 relative">
            <h1 class="text-4xl font-bold text-pink-500 mb-2 drop-shadow-sm">Love Adventure</h1>
            <p class="text-gray-500 mb-8 text-sm">Upload photos to create your hero!</p>

            <div class="flex justify-center gap-6 mb-8">
                <div class="text-center">
                    <div class="upload-circle shadow-lg" onclick="document.getElementById('playerInput').click()">
                        <img id="playerPreview" src="" class="hidden">
                        <span id="playerIcon" class="text-3xl">ü¶∏‚Äç‚ôÇÔ∏è</span>
                    </div>
                    <p class="mt-2 font-bold text-gray-600 text-sm">HERO</p>
                    <input type="file" id="playerInput" accept="image/*" class="hidden"
                        onchange="handleFile(this, 'player')">
                </div>

                <div class="text-center">
                    <div class="upload-circle shadow-lg" onclick="document.getElementById('partnerInput').click()">
                        <img id="partnerPreview" src="" class="hidden">
                        <span id="partnerIcon" class="text-3xl">üë∏</span>
                    </div>
                    <p class="mt-2 font-bold text-gray-600 text-sm">LOVE</p>
                    <input type="file" id="partnerInput" accept="image/*" class="hidden"
                        onchange="handleFile(this, 'partner')">
                </div>
            </div>

            <button id="startBtn" onclick="initGame()" disabled
                class="w-full py-4 rounded-xl font-bold text-lg text-white transition-all transform bg-gray-300 cursor-not-allowed shadow-inner">
                Waiting for Photos...
            </button>

            <p class="mt-4 text-xs text-gray-400">or try demo mode</p>
            <button onclick="startDemo()" class="text-pink-400 text-xs underline font-bold hover:text-pink-600">Quick
                Demo (No Photos)</button>
        </div>
    </div>

    <div id="game-container"></div>

    <div id="controls">
        <div class="flex gap-4">
            <div class="game-btn" id="btnLeft">‚óÄ</div>
            <div class="game-btn" id="btnRight">‚ñ∂</div>
        </div>
        <div class="game-btn bg-pink-500/30 border-pink-300" id="btnJump">‚¨Ü</div>
    </div>

    <script>
        // --- GLOBAL DEƒûƒ∞≈ûKENLER ---
        let game;
        let playerTexture = null;
        let partnerTexture = null;
        const isMobile = 'ontouchstart' in document.documentElement;

        // --- DOSYA Y√úKLEME MANTIƒûI ---
        function handleFile(input, type) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const res = e.target.result;
                    if (type === 'player') {
                        playerTexture = res;
                        document.getElementById('playerPreview').src = res;
                        document.getElementById('playerPreview').classList.remove('hidden');
                        document.getElementById('playerIcon').classList.add('hidden');
                    } else {
                        partnerTexture = res;
                        document.getElementById('partnerPreview').src = res;
                        document.getElementById('partnerPreview').classList.remove('hidden');
                        document.getElementById('partnerIcon').classList.add('hidden');
                    }
                    checkReady();
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function checkReady() {
            if (playerTexture && partnerTexture) {
                const btn = document.getElementById('startBtn');
                btn.disabled = false;
                btn.className = "w-full py-4 rounded-xl font-bold text-lg text-white transition-all transform bg-gradient-to-r from-pink-500 to-rose-500 hover:scale-105 shadow-lg shadow-pink-500/40 cursor-pointer";
                btn.innerText = "START ADVENTURE ‚ñ∂";
            }
        }

        function startDemo() {
            // Demo i√ßin ge√ßici renkli daireler yarat
            playerTexture = createDummyTexture('#2196F3', 'üòé');
            partnerTexture = createDummyTexture('#E91E63', 'üòç');
            initGame();
        }

        function createDummyTexture(color, emoji) {
            const c = document.createElement('canvas'); c.width = 100; c.height = 100;
            const x = c.getContext('2d');
            x.beginPath(); x.arc(50, 50, 50, 0, 7); x.fillStyle = color; x.fill();
            x.font = '50px serif'; x.textAlign = 'center'; x.fillText(emoji, 50, 65);
            return c.toDataURL();
        }

        function initGame() {
            document.getElementById('ui-layer').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            if (isMobile) document.getElementById('controls').style.display = 'flex';

            const config = {
                type: Phaser.AUTO,
                parent: 'game-container',
                width: window.innerWidth,
                height: window.innerHeight,
                backgroundColor: '#87CEEB',
                pixelArt: false,
                physics: {
                    default: 'arcade',
                    arcade: { gravity: { y: 1000 }, debug: false }
                },
                scene: GameScene
            };
            game = new Phaser.Game(config);
        }

        // --- OYUN SAHNESƒ∞ (LEVEL DESIGN) ---
        class GameScene extends Phaser.Scene {
            preload() {
                this.load.image('userHero', playerTexture);
                this.load.image('userLove', partnerTexture);
            }

            create() {
                // 1. ARKA PLAN (PARALLAX EFFECT)
                this.createSky();
                this.mountains = this.add.tileSprite(0, this.scale.height, this.scale.width, 400, 'mountains').setOrigin(0, 1).setScrollFactor(0.2);
                this.clouds = this.add.tileSprite(0, 100, this.scale.width, 200, 'clouds').setOrigin(0, 0).setScrollFactor(0.5);

                // 2. Platformlar ve Zemin
                this.platforms = this.physics.add.staticGroup();
                this.createLevel();

                // 3. OYUNCU (Sticker Kafa + Animasyonlu G√∂vde)
                this.player = this.add.container(100, 400);
                this.player.setSize(40, 70);
                this.physics.world.enable(this.player);
                this.player.body.setCollideWorldBounds(true);
                this.player.body.setBounce(0.1);

                // G√∂vde (Basit ≈üekil yerine ileride sprite olabilir, ≈üimdilik ≈üƒ±k bir kutu)
                this.pBody = this.add.rectangle(0, 25, 40, 45, 0x3B82F6).setStrokeStyle(2, 0xffffff);

                // KAFA (MASKELEME Sƒ∞STEMƒ∞)
                const rawHead = this.add.image(0, -15, 'userHero');
                const scaleX = 60 / rawHead.width; // Kafayƒ± 60px'e sabitle
                rawHead.setScale(scaleX);

                // Daire Maske
                const maskShape = this.make.graphics();
                maskShape.fillCircle(0, 0, 30);
                const mask = maskShape.createGeometryMask();
                rawHead.setMask(mask);

                // Sticker √áer√ßevesi (Beyaz Halka)
                const border = this.add.graphics();
                border.lineStyle(4, 0xffffff);
                border.strokeCircle(0, -15, 30);

                this.player.add([this.pBody, rawHead, border]);
                this.physics.add.collider(this.player, this.platforms);

                // 4. D√ú≈ûMANLAR (CANAVARLAR)
                this.enemies = this.physics.add.group({
                    bounceX: 1, bounceY: 0, collideWorldBounds: true
                });
                this.spawnEnemy(600, 400, 150); // Devriye gezen slime
                this.spawnEnemy(1400, 300, 200);
                this.physics.add.collider(this.enemies, this.platforms);
                this.physics.add.collider(this.player, this.enemies, this.hitEnemy, null, this);

                // 5. HEDEF (SEVGƒ∞Lƒ∞)
                this.createPartner(2800, 400);

                // 6. KAMERA & KONTROLLER
                this.cameras.main.startFollow(this.player, true, 0.1, 0.1);
                this.cameras.main.setBounds(0, 0, 3000, this.scale.height);
                this.cursors = this.input.keyboard.createCursorKeys();
                this.setupTouch();

                // Dikenler
                this.physics.add.collider(this.player, this.spikes, this.hitSpike, null, this);

                // Par√ßacƒ±k Efekti (Ko≈üarken)
                this.trail = this.add.particles(0, 0, 'particle_star', {
                    follow: this.player,
                    followOffset: { y: 40 },
                    scale: { start: 0.4, end: 0 },
                    speed: 50,
                    lifespan: 400,
                    on: false
                });
            }

            update() {
                // Parallax G√ºncelleme (Kamera hareketine g√∂re arka plan kaysƒ±n)
                this.mountains.tilePositionX = this.cameras.main.scrollX * 0.3;
                this.clouds.tilePositionX = this.cameras.main.scrollX * 0.6 + this.time.now * 0.05;

                // D√º≈üman Yapay Zekasƒ± (Basit Devriye)
                this.enemies.children.iterate((child) => {
                    if (child.body.blocked.left) child.setVelocityX(100);
                    else if (child.body.blocked.right) child.setVelocityX(-100);
                });

                const speed = 280;
                const jump = -650;
                const body = this.player.body;

                if (body.y > this.scale.height) this.scene.restart();

                // Hareket
                if (this.cursors.left.isDown || this.leftDown) {
                    body.setVelocityX(-speed);
                    this.player.setScale(-1, 1); // Sola d√∂n
                    this.trail.start();
                } else if (this.cursors.right.isDown || this.rightDown) {
                    body.setVelocityX(speed);
                    this.player.setScale(1, 1); // Saƒüa d√∂n
                    this.trail.start();
                } else {
                    body.setVelocityX(0);
                    this.trail.stop();
                }

                // Zƒ±plama
                if ((this.cursors.up.isDown || this.jumpDown) && body.touching.down) {
                    body.setVelocityY(jump);
                }
            }

            // --- ƒ∞√áERƒ∞K OLU≈ûTURUCULAR (Assets Generator) ---
            createSky() {
                // Kodla doku yaratƒ±yoruz (Resim dosyasƒ± ta≈üƒ±mamak i√ßin)
                // 1. Daƒülar
                const m = this.make.graphics({ x: 0, y: 0, add: false });
                m.fillStyle(0x6c5ce7); m.fillTriangle(0, 400, 200, 100, 400, 400); // Daƒü 1
                m.fillStyle(0xa29bfe); m.fillTriangle(200, 400, 500, 50, 800, 400); // Daƒü 2
                m.generateTexture('mountains', 800, 400);

                // 2. Bulutlar
                const c = this.make.graphics({ x: 0, y: 0, add: false });
                c.fillStyle(0xffffff, 0.8);
                c.fillCircle(50, 50, 30); c.fillCircle(90, 40, 40); c.fillCircle(130, 50, 30);
                c.generateTexture('clouds', 200, 100);

                // 3. Yƒ±ldƒ±z Particle
                const p = this.make.graphics({ x: 0, y: 0, add: false });
                p.fillStyle(0xFFD700); p.fillStar(10, 10, 5, 10, 5);
                p.generateTexture('particle_star', 20, 20);

                // 4. Canavar
                const e = this.make.graphics({ x: 0, y: 0, add: false });
                e.fillStyle(0xff0000); e.fillCircle(20, 20, 20); // Kƒ±rmƒ±zƒ± Top
                e.fillStyle(0x000000); e.fillCircle(10, 15, 5); e.fillCircle(30, 15, 5); // G√∂zler
                e.generateTexture('enemy_slime', 40, 40);
            }

            createLevel() {
                // Zemin Bloklarƒ± (√áim Deseni)
                const ground = this.make.graphics({ x: 0, y: 0, add: false });
                ground.fillStyle(0x4CAF50); ground.fillRect(0, 0, 50, 50); // Ye≈üil
                ground.fillStyle(0x388E3C); ground.fillRect(0, 40, 50, 10); // Koyu Alt
                ground.generateTexture('block', 50, 50);

                // B√∂l√ºm Tasarƒ±mƒ±
                this.buildPlatform(0, this.scale.height - 50, 30); // Ba≈ülangƒ±√ß (30 blok)
                this.buildPlatform(600, this.scale.height - 200, 5);
                this.buildPlatform(1000, this.scale.height - 350, 8);
                this.buildPlatform(1600, this.scale.height - 150, 20); // Biti≈ü yolu

                // Dikenler (Spikes)
                this.spikes = this.physics.add.staticGroup();
                this.addSpike(500, this.scale.height - 50); // Yerde
                this.addSpike(1300, this.scale.height - 50); // √áukur √∂ncesi
            }

            buildPlatform(startX, startY, widthBlocks) {
                for (let i = 0; i < widthBlocks; i++) {
                    const b = this.platforms.create(startX + (i * 50), startY, 'block');
                    b.refreshBody();
                }
            }

            addSpike(x, y) {
                // √ú√ßgen Diken
                if (!this.textures.exists('spike')) {
                    const s = this.make.graphics({ x: 0, y: 0, add: false });
                    s.fillStyle(0x7f8c8d); s.fillTriangle(0, 40, 20, 0, 40, 40);
                    s.generateTexture('spike', 40, 40);
                }
                const spike = this.spikes.create(x, y - 20, 'spike');
                spike.body.setSize(20, 20).setOffset(10, 20); // Hitbox k√º√ß√ºlt
            }

            spawnEnemy(x, y, range) {
                const enemy = this.enemies.create(x, y, 'enemy_slime');
                enemy.setVelocityX(100);
                enemy.setBounce(1);
                enemy.setCollideWorldBounds(true);
            }

            createPartner(x, y) {
                this.partner = this.add.container(x, y);
                this.partner.setSize(40, 70);
                this.physics.world.enable(this.partner);
                this.partner.body.setAllowGravity(false);
                this.partner.body.setImmovable(true);

                const tBody = this.add.rectangle(0, 25, 40, 45, 0xFF69B4).setStrokeStyle(2, 0xffffff);
                const rawHead = this.add.image(0, -15, 'userLove');
                const scaleX = 60 / rawHead.width;
                rawHead.setScale(scaleX);

                const maskShape = this.make.graphics();
                maskShape.fillCircle(0, 0, 30);
                const mask = maskShape.createGeometryMask();
                rawHead.setMask(mask);

                const border = this.add.graphics();
                border.lineStyle(4, 0xffffff);
                border.strokeCircle(0, -15, 30);

                this.partner.add([tBody, rawHead, border]);
                this.physics.add.overlap(this.player, this.partner, this.winGame, null, this);
            }

            // --- ETKƒ∞LE≈ûƒ∞MLER ---
            hitSpike() {
                this.cameras.main.shake(200, 0.01);
                this.player.setTint(0xff0000);
                this.time.delayedCall(300, () => this.scene.restart());
            }

            hitEnemy(player, enemy) {
                // Eƒüer √ºst√ºne zƒ±pladƒ±ysa canavarƒ± √∂ld√ºr (Mario mantƒ±ƒüƒ±)
                if (player.body.velocity.y > 0 && player.y < enemy.y) {
                    enemy.destroy();
                    player.setVelocityY(-400); // Geri zƒ±pla
                } else {
                    this.hitSpike(); // √ñl
                }
            }

            winGame() {
                this.physics.pause();
                const cam = this.cameras.main;

                // Konfeti
                for (let i = 0; i < 50; i++) {
                    const p = this.add.circle(cam.scrollX + Math.random() * cam.width, cam.scrollY + Math.random() * cam.height, 5, Math.random() * 0xffffff);
                    this.tweens.add({
                        targets: p, y: p.y + 200, alpha: 0, duration: 1000 + Math.random() * 1000
                    });
                }

                // Win Mesajƒ±
                const box = this.add.rectangle(cam.scrollX + cam.width / 2, cam.height / 2, 300, 150, 0xffffff).setAlpha(0.9);
                this.add.text(cam.scrollX + cam.width / 2, cam.height / 2 - 20, 'LOVE WINS!', {
                    fontSize: '32px', color: '#ff0055', fontStyle: 'bold'
                }).setOrigin(0.5);

                this.add.text(cam.scrollX + cam.width / 2, cam.height / 2 + 30, 'Tap to Restart', {
                    fontSize: '16px', color: '#333'
                }).setOrigin(0.5);

                this.input.on('pointerdown', () => this.scene.restart());
            }

            setupTouch() {
                this.leftDown = false; this.rightDown = false; this.jumpDown = false;
                const l = document.getElementById('btnLeft');
                const r = document.getElementById('btnRight');
                const j = document.getElementById('btnJump');

                const bind = (el, prop) => {
                    if (!el) return;
                    el.addEventListener('touchstart', (e) => { e.preventDefault(); this[prop] = true });
                    el.addEventListener('touchend', (e) => { e.preventDefault(); this[prop] = false });
                    el.addEventListener('mousedown', (e) => { e.preventDefault(); this[prop] = true }); // Test i√ßin mouse
                    el.addEventListener('mouseup', (e) => { e.preventDefault(); this[prop] = false });
                };
                bind(l, 'leftDown'); bind(r, 'rightDown'); bind(j, 'jumpDown');
            }
        }
    </script>
</body>

</html>