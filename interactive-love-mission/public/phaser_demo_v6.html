<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Love Bros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #333;
            font-family: 'Press Start 2P', cursive;
            touch-action: none;
        }

        #game-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            /* BaÅŸlangÄ±Ã§ta gizli */
            z-index: 1;
        }

        /* BaÅŸlangÄ±Ã§ EkranÄ± */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #5C94FC;
            /* Mario GÃ¶kyÃ¼zÃ¼ Mavisi */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }

        .pixel-card {
            background: #fff;
            border: 4px solid #000;
            box-shadow: 8px 8px 0px rgba(0, 0, 0, 0.2);
            padding: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .btn-mario {
            background: #FF0000;
            color: white;
            border: 2px solid #000;
            padding: 15px;
            width: 100%;
            cursor: pointer;
            text-transform: uppercase;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            margin-top: 10px;
            box-shadow: 4px 4px 0px #880000;
        }

        .btn-mario:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px #880000;
        }

        .btn-mario:disabled {
            background: #ccc;
            box-shadow: none;
            color: #666;
            cursor: not-allowed;
        }

        /* Mobil Kontroller */
        #controls {
            display: none;
            position: absolute;
            bottom: 20px;
            width: 100%;
            padding: 0 20px;
            justify-content: space-between;
            z-index: 100;
            pointer-events: none;
        }

        .d-pad {
            display: flex;
            gap: 10px;
        }

        .ctrl-btn {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 0, 0.4);
            border: 4px solid #000;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: black;
            pointer-events: auto;
            user-select: none;
        }

        .ctrl-btn:active {
            background: rgba(255, 255, 0, 0.8);
        }
    </style>
</head>

<body>

    <div id="ui-layer">
        <h1 class="text-white text-2xl mb-4 drop-shadow-md" style="text-shadow: 4px 4px 0 #000;">SUPER LOVE BROS</h1>

        <div class="pixel-card">
            <p class="text-xs mb-4 text-gray-600" style="line-height: 1.5;">PLAY AS THE HERO<br>SAVE YOUR LOVE!</p>

            <div class="flex justify-center gap-4 mb-4">
                <div onclick="document.getElementById('p1').click()" class="cursor-pointer hover:scale-105 transition">
                    <div
                        class="w-20 h-20 border-4 border-black bg-blue-100 flex items-center justify-center overflow-hidden relative">
                        <img id="imgP1" class="absolute w-full h-full object-cover hidden">
                        <span id="iconP1" class="text-2xl">ðŸ¦¸</span>
                    </div>
                    <p class="text-[10px] mt-2">YOU</p>
                    <input type="file" id="p1" class="hidden" accept="image/*" onchange="loadFile(this, 'imgP1', 'p1')">
                </div>

                <div onclick="document.getElementById('p2').click()" class="cursor-pointer hover:scale-105 transition">
                    <div
                        class="w-20 h-20 border-4 border-black bg-pink-100 flex items-center justify-center overflow-hidden relative">
                        <img id="imgP2" class="absolute w-full h-full object-cover hidden">
                        <span id="iconP2" class="text-2xl">ðŸ‘¸</span>
                    </div>
                    <p class="text-[10px] mt-2">LOVE</p>
                    <input type="file" id="p2" class="hidden" accept="image/*" onchange="loadFile(this, 'imgP2', 'p2')">
                </div>
            </div>

            <button id="startBtn" onclick="startGame()" disabled class="btn-mario">INSERT COIN (Start)</button>
            <div onclick="startDemo()" class="mt-4 text-[10px] text-blue-600 underline cursor-pointer">Quick Demo (No
                Photos)</div>
        </div>
    </div>

    <div id="game-container"></div>

    <div id="controls">
        <div class="d-pad">
            <div class="ctrl-btn" id="btnLeft">â—€</div>
            <div class="ctrl-btn" id="btnRight">â–¶</div>
        </div>
        <div class="ctrl-btn bg-red-500/50" id="btnJump">A</div>
    </div>

    <script>
        // --- GLOBAL VARIABLES ---
        let gameInstance;
        let playerTex = null;
        let partnerTex = null;
        const isMobile = 'ontouchstart' in document.documentElement;

        // --- UI LOGIC ---
        function loadFile(input, imgId, type) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    const el = document.getElementById(imgId);
                    el.src = e.target.result;
                    el.classList.remove('hidden');
                    if (imgId === 'imgP1') {
                        playerTex = e.target.result;
                        document.getElementById('iconP1').style.display = 'none';
                    }
                    else {
                        partnerTex = e.target.result;
                        document.getElementById('iconP2').style.display = 'none';
                    }
                    checkReady();
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function checkReady() {
            if (playerTex && partnerTex) {
                const btn = document.getElementById('startBtn');
                btn.disabled = false;
                btn.innerText = "START GAME!";
            }
        }

        function startDemo() {
            // Demo iÃ§in geÃ§ici texture yarat
            playerTex = createPlaceholderTexture('#FF0000', 'M');
            partnerTex = createPlaceholderTexture('#FF69B4', 'P');
            startGame();
        }

        function createPlaceholderTexture(color, letter) {
            const c = document.createElement('canvas'); c.width = 64; c.height = 64;
            const x = c.getContext('2d');
            x.fillStyle = color; x.fillRect(0, 0, 64, 64);
            x.fillStyle = 'white'; x.font = '40px monospace'; x.fillText(letter, 20, 45);
            return c.toDataURL();
        }

        function startGame() {
            // UI'Ä± tamamen DOM'dan kaldÄ±r (Ã‡akÄ±ÅŸmayÄ± Ã¶nlemek iÃ§in)
            const ui = document.getElementById('ui-layer');
            ui.parentNode.removeChild(ui);

            // Oyun alanÄ±nÄ± gÃ¶ster
            const container = document.getElementById('game-container');
            container.style.display = 'block';
            if (isMobile) document.getElementById('controls').style.display = 'flex';

            // Phaser'Ä± baÅŸlat
            initPhaser();
        }

        // --- PHASER GAME LOGIC ---
        function initPhaser() {
            const config = {
                type: Phaser.AUTO,
                parent: 'game-container',
                width: window.innerWidth,
                height: window.innerHeight,
                backgroundColor: '#5C94FC', // Mario GÃ¶kyÃ¼zÃ¼
                pixelArt: false, // Daha yumuÅŸak gÃ¶rÃ¼ntÃ¼ iÃ§in
                physics: {
                    default: 'arcade',
                    arcade: { gravity: { y: 1200 }, debug: false }
                },
                scene: MainScene
            };
            gameInstance = new Phaser.Game(config);
        }

        class MainScene extends Phaser.Scene {
            preload() {
                this.load.image('pFace', playerTex);
                this.load.image('loveFace', partnerTex);
            }

            create() {
                // 1. ASSET GENERATION (Kodla Mario Grafikleri Ã‡izme)
                this.generateAssets();

                // 2. LEVEL OLUÅžTURMA
                const h = this.scale.height;
                const groundY = h - 64;

                // Arka Plan Dekor
                this.add.tileSprite(0, h - 100, 4000, 300, 'hills').setOrigin(0, 1).setScrollFactor(0.2);
                this.add.tileSprite(0, 100, 4000, 200, 'clouds').setOrigin(0, 0).setScrollFactor(0.1);

                // Platformlar
                this.platforms = this.physics.add.staticGroup();

                // Zemin (Sonsuz gibi)
                for (let i = 0; i < 60; i++) {
                    this.platforms.create(i * 64, h - 32, 'ground'); // Alt taban
                }

                // Borular ve Bloklar
                this.createPipe(600, h - 160);
                this.createBlock(900, h - 250); // Soru iÅŸareti kutusu
                this.createBrick(964, h - 250);
                this.createBrick(1028, h - 250);

                this.createPipe(1400, h - 190); // Daha yÃ¼ksek boru

                // 3. OYUNCU (Mario Style Body + User Head)
                this.player = this.add.container(100, h - 300);
                this.player.setSize(40, 60);
                this.physics.world.enable(this.player);
                this.player.body.setCollideWorldBounds(true);
                this.player.body.setBounce(0); // Mario zÄ±plamaz, kÃ¼t diye durur

                // VÃ¼cut (Tulum)
                const bodyGraphics = this.add.graphics();
                bodyGraphics.fillStyle(0xFF0000); // KÄ±rmÄ±zÄ± GÃ¶mlek
                bodyGraphics.fillRect(-15, 0, 30, 30);
                bodyGraphics.fillStyle(0x0000FF); // Mavi Tulum
                bodyGraphics.fillRect(-15, 20, 30, 20); // Bacaklar

                // Kafa
                const head = this.add.image(0, -10, 'pFace');
                head.setDisplaySize(50, 50);
                // KafayÄ± yuvarlak yap
                const maskG = this.make.graphics();
                maskG.fillCircle(0, 0, 25);
                const mask = maskG.createGeometryMask();
                head.setMask(mask);
                // Kafa Ã§evresi
                const headRing = this.add.graphics();
                headRing.lineStyle(3, 0xFFFFFF);
                headRing.strokeCircle(0, -10, 26);

                this.player.add([bodyGraphics, head, headRing]);
                this.physics.add.collider(this.player, this.platforms);

                // 4. HEDEF (PRENSES/PRENS)
                this.createGoal(2800, h - 160);

                // 5. DÃœÅžMANLAR (Goomba TarzÄ±)
                this.enemies = this.physics.add.group();
                this.spawnGoomba(750, h - 100);
                this.spawnGoomba(1200, h - 100);
                this.physics.add.collider(this.enemies, this.platforms);
                this.physics.add.overlap(this.player, this.enemies, this.handleEnemyCollision, null, this);

                // 6. KAMERA
                this.cameras.main.startFollow(this.player, true, 0.1, 0.1);
                this.cameras.main.setBounds(0, 0, 3000, h);

                // 7. KONTROLLER
                this.cursors = this.input.keyboard.createCursorKeys();
                this.setupTouchControls();

                // Yardim Metni
                this.add.text(20, 20, 'ARROWS / BUTTONS TO MOVE', {
                    fontFamily: 'monospace', fontSize: '20px', fill: '#fff', stroke: '#000', strokeThickness: 4
                }).setScrollFactor(0);
            }

            update() {
                const speed = 250;
                const jump = -650;
                const body = this.player.body;

                if (body.y > this.scale.height) this.scene.restart(); // DÃ¼ÅŸerse Ã¶lÃ¼r

                // Hareket
                if (this.cursors.left.isDown || this.leftDown) {
                    body.setVelocityX(-speed);
                    this.player.setScale(-1, 1); // Sola dÃ¶n
                } else if (this.cursors.right.isDown || this.rightDown) {
                    body.setVelocityX(speed);
                    this.player.setScale(1, 1); // SaÄŸa dÃ¶n
                } else {
                    body.setVelocityX(0);
                }

                // ZÄ±plama
                if ((this.cursors.up.isDown || this.jumpDown) && body.touching.down) {
                    body.setVelocityY(jump);
                }

                // DÃ¼ÅŸman Yapay ZekasÄ±
                this.enemies.children.iterate(enemy => {
                    if (enemy && enemy.body) {
                        if (enemy.body.blocked.right) enemy.setVelocityX(-100);
                        if (enemy.body.blocked.left) enemy.setVelocityX(100);
                    }
                });
            }

            // --- YARDIMCI FONKSÄ°YONLAR ---

            generateAssets() {
                // Zemin (Ground) - Kahverengi Ã¼zerine yeÅŸil Ã§im
                const g = this.make.graphics({ x: 0, y: 0, add: false });
                g.fillStyle(0x8B4513); g.fillRect(0, 0, 64, 64); // Toprak
                g.fillStyle(0x00AA00); g.fillRect(0, 0, 64, 10); // Ã‡im
                g.lineStyle(2, 0x000000); g.strokeRect(0, 0, 64, 64); // Ã‡erÃ§eve
                g.generateTexture('ground', 64, 64);

                // Soru Ä°ÅŸareti BloÄŸu
                const q = this.make.graphics({ x: 0, y: 0, add: false });
                q.fillStyle(0xFFA500); q.fillRect(0, 0, 64, 64); // Turuncu
                q.lineStyle(4, 0x000000); q.strokeRect(0, 0, 64, 64);
                q.fillStyle(0x000000); q.fillRect(20, 10, 24, 10); q.fillRect(44, 20, 10, 20); // "?" Ã§izimi (basit)
                q.fillRect(28, 50, 10, 10);
                q.generateTexture('block', 64, 64);

                // TuÄŸla (Brick)
                const b = this.make.graphics({ x: 0, y: 0, add: false });
                b.fillStyle(0xB22222); b.fillRect(0, 0, 64, 64);
                b.lineStyle(2, 0x000000); b.moveTo(0, 32); b.lineTo(64, 32);
                b.moveTo(32, 0); b.lineTo(32, 32); b.moveTo(16, 32); b.lineTo(16, 64);
                b.strokePath();
                b.generateTexture('brick', 64, 64);

                // YeÅŸil Boru
                const p = this.make.graphics({ x: 0, y: 0, add: false });
                p.fillStyle(0x00AA00); p.fillRect(0, 0, 64, 96); // GÃ¶vde
                p.fillStyle(0x008800); p.fillRect(0, 0, 70, 30); // Kafa
                p.lineStyle(4, 0x000000); p.strokeRect(0, 0, 64, 96); p.strokeRect(-3, 0, 70, 30);
                p.generateTexture('pipe', 70, 100);

                // DÃ¼ÅŸman (Goomba-ish)
                const e = this.make.graphics({ x: 0, y: 0, add: false });
                e.fillStyle(0x8B4513); e.fillCircle(20, 20, 20); // Kahve GÃ¶vde
                e.fillStyle(0xFFFFFF); e.fillCircle(12, 15, 5); e.fillCircle(28, 15, 5); // GÃ¶zler
                e.fillStyle(0x000000); e.fillCircle(14, 15, 2); e.fillCircle(26, 15, 2);
                e.generateTexture('goomba', 40, 40);

                // Bulutlar
                const c = this.make.graphics({ x: 0, y: 0, add: false });
                c.fillStyle(0xFFFFFF); c.fillCircle(30, 30, 30); c.fillCircle(60, 20, 40); c.fillCircle(90, 30, 30);
                c.generateTexture('clouds', 150, 80);

                // Tepeler
                const h = this.make.graphics({ x: 0, y: 0, add: false });
                h.fillStyle(0x00AA00); h.fillTriangle(0, 200, 100, 50, 200, 200);
                h.generateTexture('hills', 200, 200);
            }

            createPipe(x, y) {
                const pipe = this.platforms.create(x, y, 'pipe');
                pipe.setOrigin(0, 1); // Alttan hizala
                pipe.refreshBody();
            }

            createBlock(x, y) {
                this.platforms.create(x, y, 'block').refreshBody();
            }
            createBrick(x, y) {
                this.platforms.create(x, y, 'brick').refreshBody();
            }

            spawnGoomba(x, y) {
                const g = this.enemies.create(x, y, 'goomba');
                g.setBounce(1);
                g.setCollideWorldBounds(true);
                g.setVelocityX(-100);
            }

            createGoal(x, y) {
                // Kale yerine partner orada beklesin
                this.goal = this.add.container(x, y);
                this.goal.setSize(50, 80);
                this.physics.world.enable(this.goal);
                this.goal.body.setAllowGravity(false);
                this.goal.body.setImmovable(true);

                // Partner VÃ¼cut (Pembe Elbise)
                const dress = this.add.graphics();
                dress.fillStyle(0xFF69B4); dress.fillTriangle(-20, 40, 20, 40, 0, 0); // Elbise

                const head = this.add.image(0, -10, 'loveFace');
                head.setDisplaySize(50, 50);
                const maskG = this.make.graphics();
                maskG.fillCircle(0, 0, 25);
                const mask = maskG.createGeometryMask();
                head.setMask(mask);
                const ring = this.add.graphics();
                ring.lineStyle(3, 0xFFFFFF); ring.strokeCircle(0, -10, 26);

                this.goal.add([dress, head, ring]);

                this.physics.add.collider(this.goal, this.platforms);
                this.physics.add.overlap(this.player, this.goal, this.winGame, null, this);
            }

            handleEnemyCollision(player, enemy) {
                // Mario MantÄ±ÄŸÄ±: ÃœstÃ¼ne basarsan Ã¶lÃ¼r, yandan Ã§arparsan sen Ã¶lÃ¼rsÃ¼n
                if (player.body.velocity.y > 0 && player.y < enemy.y - 10) {
                    enemy.destroy(); // Ezildi!
                    player.setVelocityY(-300); // Hafif zÄ±pla
                } else {
                    this.scene.restart(); // Mario Ã¶ldÃ¼ :(
                }
            }

            winGame() {
                this.physics.pause();
                this.add.text(this.cameras.main.scrollX + 200, 200, "YOU SAVED LOVE!", {
                    fontFamily: 'monospace', fontSize: '40px', backgroundColor: '#000', color: '#fff', padding: 20
                }).setOrigin(0.5);

                // Havai FiÅŸek benzeri efekt
                const particles = this.add.particles(0, 0, 'block', {
                    speed: 200, scale: { start: 0.2, end: 0 }, blendMode: 'ADD', lifespan: 1000
                });
                particles.emitParticleAt(this.goal.x, this.goal.y, 50);
            }

            setupTouchControls() {
                this.leftDown = false; this.rightDown = false; this.jumpDown = false;
                const l = document.getElementById('btnLeft');
                const r = document.getElementById('btnRight');
                const j = document.getElementById('btnJump');

                const bind = (el, prop) => {
                    if (!el) return;
                    el.addEventListener('touchstart', (e) => { e.preventDefault(); this[prop] = true });
                    el.addEventListener('touchend', (e) => { e.preventDefault(); this[prop] = false });
                    el.addEventListener('mousedown', (e) => { e.preventDefault(); this[prop] = true });
                    el.addEventListener('mouseup', (e) => { e.preventDefault(); this[prop] = false });
                };
                bind(l, 'leftDown'); bind(r, 'rightDown'); bind(j, 'jumpDown');
            }
        }
    </script>
</body>

</html>